@model SistemaHotelero.Models.Recepcion

@{
    ViewData["Title"] = "Detalle de Reserva";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container mt-4">
    <div class="card shadow border-0 mb-4">
        <div class="card-body">
            <h5 class="fw-bold text-primary mb-3">Resumen de la Habitación</h5>
            <div class="row mb-3">
                <div class="col-md-2"><strong>Número:</strong><br />@Model.Habitacion.Numero</div>
                <div class="col-md-2"><strong>Detalles:</strong><br />@Model.Habitacion.Detalle</div>
                <div class="col-md-2"><strong>Categoría:</strong><br />@Model.Habitacion.Categoria?.Descripcion</div>
                <div class="col-md-2"><strong>Piso:</strong><br />@Model.Habitacion.Piso?.Descripcion</div>
                <div class="col-md-2"><strong>Precio por noche:</strong><br />$@Model.Habitacion.Precio.ToString("F2")</div>
            </div>
        </div>
    </div>
        background: #f8f9fa;
    <div class="card shadow border-0 mb-4">
        <div class="card-body">
            <h5 class="fw-bold text-primary mb-3">Datos del Cliente</h5>
            <div class="row mb-3">
                <div class="col-md-3"><strong>Cliente:</strong><br />@Model.Recepcion.ApplicationUser.Nombre @Model.Recepcion.ApplicationUser.Apellido</div>
                <div class="col-md-3"><strong>Documento:</strong><br />@Model.Recepcion.ApplicationUser.TipoDocumento: @Model.Recepcion.ApplicationUser.NumeroDocumento</div>
                <div class="col-md-3"><strong>Correo:</strong><br />@Model.Recepcion.ApplicationUser.Email</div>
                <div class="col-md-3"><strong>Teléfono:</strong><br />@(Model.Recepcion.ApplicationUser.PhoneNumber ?? "No registrado")</div>
            </div>
        </div>
    </div>
                    </div>
    <div class="card shadow border-0 mb-4">
        <div class="card-body">
            <h5 class="fw-bold text-primary mb-3">Detalles de la Reserva</h5>
            <div class="row mb-3">
                <div class="col-md-2"><strong>Fecha Entrada:</strong><br />@Model.Recepcion.FechaEntrada.ToShortDateString()</div>
                <div class="col-md-2"><strong>Fecha Salida:</strong><br />@(Model.Recepcion.FechaSalida?.ToShortDateString() ?? "No definida")</div>
                <div class="col-md-2"><strong>Costo Total:</strong><br />$@Model.Recepcion.PrecioInicial.ToString("F2")</div>
                <div class="col-md-2"><strong>Adelanto:</strong><br />$@Model.Recepcion.Adelanto.ToString("F2")</div>
                <div class="col-md-2"><strong>Saldo Pendiente:</strong><br />$@((Model.Recepcion.PrecioInicial - Model.Recepcion.Adelanto).ToString("F2"))</div>
                <div class="col-md-2">
                    <strong>Estado:</strong><br />
                    @if (Model.Recepcion.Estado)
                    {
                        <span class="badge bg-success">Activa</span>
                    }
                    else
                    {
                        <span class="badge bg-secondary">Finalizada</span>
                    }
                </div>
                        <span class="detail-value">@Model.Recepcion.ApplicationUser.Nombre @Model.Recepcion.ApplicationUser.Apellido</span>
            <div class="row">
                <div class="col-md-12">
                    <strong>Observaciones:</strong><br />
                    @(!string.IsNullOrEmpty(Model.Recepcion.Observacion) ? Model.Recepcion.Observacion : "Ninguna")
                </div>
            </div>
        </div>
    </div>
                </div>
    <div class="card shadow border-0 mb-4">
        <div class="card-body">
            <h5 class="fw-bold text-primary mb-3">Servicios a la Habitación</h5>
            @if (Model.Ventas != null && Model.Ventas.Any())
            {
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <thead class="table-dark">
                            <tr>
                                <th>Producto</th>
                                <th>Cantidad</th>
                                <th>Precio Unitario</th>
                                <th>SubTotal</th>
                                <th>Fecha</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var venta in Model.Ventas)
                            {
                                foreach (var detalle in venta.DetalleVenta)
                                {
                                    <tr>
                                        <td>@detalle.Producto.Nombre</td>
                                        <td class="text-center">@detalle.Cantidad</td>
                                        <td class="text-end">$@detalle.Producto.Precio.ToString("F2")</td>
                                        <td class="text-end">$@detalle.SubTotal.ToString("F2")</td>
                                        <td class="text-center">@venta.FechaCreacion.ToShortDateString()</td>
                                    </tr>
                                }
                            }
                        </tbody>
                        <tfoot>
                            <tr>
                                <td colspan="3" class="text-end fw-bold">Total ventas:</td>
                                <td class="text-end fw-bold" colspan="2">
                                    $@Model.Ventas.SelectMany(v => v.DetalleVenta).Sum(d => d.SubTotal).ToString("F2")
                                </td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            }
            else
            {
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i> No se encontraron ventas registradas para la habitación.
                </div>
            }
        </div>
    </div>
                    }
    <div class="text-end">
        <a asp-action="Index" class="btn btn-secondary">
            <i class="fas fa-arrow-left me-1"></i> Volver al listado
        </a>
    </div>
</div>
        <h5 class="section-title">Servicios a la Habitación</h5>
        @if (Model.Ventas != null && Model.Ventas.Any())
        {
            <div class="table-responsive mb-4">
                <table class="table table-hover shadow-sm rounded venta-table">
                    <thead class="table-dark text-center align-middle">
                        <tr>
                            <th>Producto</th>
                            <th>Cantidad</th>
                            <th>Precio Unitario</th>
                            <th>SubTotal</th>
                            <th>Fecha</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var venta in Model.Ventas)
                        {
                            foreach (var detalle in venta.DetalleVenta)
                            {
                                <tr>
                                    <td>@detalle.Producto.Nombre</td>
                                    <td class="text-center">@detalle.Cantidad</td>
                                    <td class="text-end">$@detalle.Producto.Precio.ToString("F2")</td>
                                    <td class="text-end">$@detalle.SubTotal.ToString("F2")</td>
                                    <td class="text-center">@venta.FechaCreacion.ToShortDateString()</td>
                                </tr>
                            }
                        }
                    </tbody>
                    <tfoot>
                        <tr>
                            <td colspan="3" class="text-end fw-bold">Total ventas:</td>
                            <td class="text-end fw-bold text-primary" colspan="2">
                                $@Model.Ventas.SelectMany(v => v.DetalleVenta).Sum(d => d.SubTotal).ToString("F2")
                            </td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        }
        else
        { 
        <div class="empty-services">
            <i class="fas fa-info-circle"></i> No se encontraron ventas registradas para la habitación.
        </div>
        }

        <div class="buttons-container">
            <a asp-action="Index" class="btn-action btn-secondary">
                <i class="fas fa-arrow-left"></i> Volver al listado
            </a>
        </div>
    </div>
</div>